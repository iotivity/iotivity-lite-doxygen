<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>IoTivity-Lite: oc_pki.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">IoTivity-Lite
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('oc__pki_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">oc_pki.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>OCF public key infrastructure (PKI) functions.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="oc__export_8h.html">oc_export.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="oc__sp_8h.html">oc_sp.h</a>&quot;</code><br />
<code>#include &lt;mbedtls/build_info.h&gt;</code><br />
<code>#include &lt;mbedtls/mbedtls_config.h&gt;</code><br />
<code>#include &lt;mbedtls/x509_crt.h&gt;</code><br />
<code>#include &lt;stddef.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:af29204f5d000da45ad49dbea7508a95f"><td class="memItemLeft" align="right" valign="top">typedef int(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc__pki_8h.html#af29204f5d000da45ad49dbea7508a95f">mbedtls_pk_ecp_gen_key_cb_t</a>) (size_t device, mbedtls_ecp_group_id grp_id, mbedtls_pk_context *pk, int(*f_rng) (void *, unsigned char *, size_t), void *p_rng)</td></tr>
<tr class="memdesc:af29204f5d000da45ad49dbea7508a95f"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function generates the ECP key for the identity certificate of the device.  <a href="oc__pki_8h.html#af29204f5d000da45ad49dbea7508a95f">More...</a><br /></td></tr>
<tr class="separator:af29204f5d000da45ad49dbea7508a95f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b55ababec511ce8c3f5ebfae983804a"><td class="memItemLeft" align="right" valign="top">typedef int(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc__pki_8h.html#a4b55ababec511ce8c3f5ebfae983804a">mbedtls_pk_parse_key_cb_t</a>) (size_t device, mbedtls_pk_context *pk, const unsigned char *key, size_t keylen, const unsigned char *pwd, size_t pwdlen, int(*f_rng) (void *, unsigned char *, size_t), void *p_rng)</td></tr>
<tr class="memdesc:a4b55ababec511ce8c3f5ebfae983804a"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function loads a private key for use with identity or manufacturer certificates stored in the credential resource of a device.  <a href="oc__pki_8h.html#a4b55ababec511ce8c3f5ebfae983804a">More...</a><br /></td></tr>
<tr class="separator:a4b55ababec511ce8c3f5ebfae983804a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4078582ecfdc45634dfde779e420a4f2"><td class="memItemLeft" align="right" valign="top">typedef int(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc__pki_8h.html#a4078582ecfdc45634dfde779e420a4f2">mbedtls_pk_write_key_der_cb_t</a>) (size_t device, const mbedtls_pk_context *ctx, unsigned char *buf, size_t size)</td></tr>
<tr class="memdesc:a4078582ecfdc45634dfde779e420a4f2"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function writes a private key to the credential resource for storage.  <a href="oc__pki_8h.html#a4078582ecfdc45634dfde779e420a4f2">More...</a><br /></td></tr>
<tr class="separator:a4078582ecfdc45634dfde779e420a4f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf88521c6e1a81e1e429f8998270c9a1"><td class="memItemLeft" align="right" valign="top"><a id="aaf88521c6e1a81e1e429f8998270c9a1"></a>
typedef struct oc_pki_pk_functions_s&#160;</td><td class="memItemRight" valign="bottom"><b>oc_pki_pk_functions_t</b></td></tr>
<tr class="separator:aaf88521c6e1a81e1e429f8998270c9a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a96373a3f65a5a29bafab923471f8aa3a"><td class="memItemLeft" align="right" valign="top">typedef int(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc__pki_8h.html#a96373a3f65a5a29bafab923471f8aa3a">oc_pki_verify_certificate_cb_t</a>) (struct oc_tls_peer_t *peer, const mbedtls_x509_crt *crt, int depth, uint32_t *flags)</td></tr>
<tr class="memdesc:a96373a3f65a5a29bafab923471f8aa3a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback invoked after ocf verifies the certificate chain.  <a href="oc__pki_8h.html#a96373a3f65a5a29bafab923471f8aa3a">More...</a><br /></td></tr>
<tr class="separator:a96373a3f65a5a29bafab923471f8aa3a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a35ac3b04f4e220eb57b47ebd501469b2"><td class="memItemLeft" align="right" valign="top">typedef bool(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc__pki_8h.html#a35ac3b04f4e220eb57b47ebd501469b2">pk_free_key_cb_t</a>) (size_t device, const unsigned char *key, size_t keylen)</td></tr>
<tr class="memdesc:a35ac3b04f4e220eb57b47ebd501469b2"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function frees the private key of the device generated by mbedtls_pk_ecp_gen_key_cb_t.  <a href="oc__pki_8h.html#a35ac3b04f4e220eb57b47ebd501469b2">More...</a><br /></td></tr>
<tr class="separator:a35ac3b04f4e220eb57b47ebd501469b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a667f95ddb5dcb4ed5eaeb72fe201c2f6"><td class="memItemLeft" align="right" valign="top">OC_API int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc__pki_8h.html#a667f95ddb5dcb4ed5eaeb72fe201c2f6">oc_pki_add_identity_cert</a> (size_t device, const unsigned char *cert, size_t cert_size, const unsigned char *key, size_t key_size)</td></tr>
<tr class="memdesc:a667f95ddb5dcb4ed5eaeb72fe201c2f6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add a PKI identity certificate.  <a href="oc__pki_8h.html#a667f95ddb5dcb4ed5eaeb72fe201c2f6">More...</a><br /></td></tr>
<tr class="separator:a667f95ddb5dcb4ed5eaeb72fe201c2f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab97e9763dae4cd5f115f0f4d0866ff4"><td class="memItemLeft" align="right" valign="top">OC_API int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc__pki_8h.html#aab97e9763dae4cd5f115f0f4d0866ff4">oc_pki_add_mfg_cert</a> (size_t device, const unsigned char *cert, size_t cert_size, const unsigned char *key, size_t key_size)</td></tr>
<tr class="memdesc:aab97e9763dae4cd5f115f0f4d0866ff4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add the manufacturer's PKI identity certificate.  <a href="oc__pki_8h.html#aab97e9763dae4cd5f115f0f4d0866ff4">More...</a><br /></td></tr>
<tr class="separator:aab97e9763dae4cd5f115f0f4d0866ff4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72061193a3d41bf230a2926fc3e17109"><td class="memItemLeft" align="right" valign="top">OC_API int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc__pki_8h.html#a72061193a3d41bf230a2926fc3e17109">oc_pki_add_mfg_intermediate_cert</a> (size_t device, int credid, const unsigned char *cert, size_t cert_size)</td></tr>
<tr class="memdesc:a72061193a3d41bf230a2926fc3e17109"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add an intermediate manufacture CA certificate.  <a href="oc__pki_8h.html#a72061193a3d41bf230a2926fc3e17109">More...</a><br /></td></tr>
<tr class="separator:a72061193a3d41bf230a2926fc3e17109"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0955c5ab3d9f103a440adf48b47e6ff3"><td class="memItemLeft" align="right" valign="top">OC_API int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc__pki_8h.html#a0955c5ab3d9f103a440adf48b47e6ff3">oc_pki_add_mfg_trust_anchor</a> (size_t device, const unsigned char *cert, size_t cert_size)</td></tr>
<tr class="memdesc:a0955c5ab3d9f103a440adf48b47e6ff3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add manufacture trust anchor CA.  <a href="oc__pki_8h.html#a0955c5ab3d9f103a440adf48b47e6ff3">More...</a><br /></td></tr>
<tr class="separator:a0955c5ab3d9f103a440adf48b47e6ff3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac7edd9a38172f7a0ef531b148e32b855"><td class="memItemLeft" align="right" valign="top">OC_API int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc__pki_8h.html#ac7edd9a38172f7a0ef531b148e32b855">oc_pki_add_trust_anchor</a> (size_t device, const unsigned char *cert, size_t cert_size)</td></tr>
<tr class="memdesc:ac7edd9a38172f7a0ef531b148e32b855"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add trust anchor CA.  <a href="oc__pki_8h.html#ac7edd9a38172f7a0ef531b148e32b855">More...</a><br /></td></tr>
<tr class="separator:ac7edd9a38172f7a0ef531b148e32b855"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a383674de8688e1f06394d2d4b2acea8c"><td class="memItemLeft" align="right" valign="top">OC_API bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc__pki_8h.html#a383674de8688e1f06394d2d4b2acea8c">oc_pki_get_pk_functions</a> (oc_pki_pk_functions_t *pk_functions)</td></tr>
<tr class="memdesc:a383674de8688e1f06394d2d4b2acea8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the PK functions for the identity certificate or the manufacturer certificate.  <a href="oc__pki_8h.html#a383674de8688e1f06394d2d4b2acea8c">More...</a><br /></td></tr>
<tr class="separator:a383674de8688e1f06394d2d4b2acea8c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5915036eb21af89dae768c8b59d32476"><td class="memItemLeft" align="right" valign="top">OC_API <a class="el" href="oc__pki_8h.html#a96373a3f65a5a29bafab923471f8aa3a">oc_pki_verify_certificate_cb_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc__pki_8h.html#a5915036eb21af89dae768c8b59d32476">oc_pki_get_verify_certificate_cb</a> (void)</td></tr>
<tr class="memdesc:a5915036eb21af89dae768c8b59d32476"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the verification callback for the certificate chain.  <a href="oc__pki_8h.html#a5915036eb21af89dae768c8b59d32476">More...</a><br /></td></tr>
<tr class="separator:a5915036eb21af89dae768c8b59d32476"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a45268a2eeaee3686f497f25d97dc43e4"><td class="memItemLeft" align="right" valign="top">OC_API bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc__pki_8h.html#a45268a2eeaee3686f497f25d97dc43e4">oc_pki_set_pk_functions</a> (const oc_pki_pk_functions_t *pk_functions)</td></tr>
<tr class="memdesc:a45268a2eeaee3686f497f25d97dc43e4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the PK functions for the identity certificate or the manufacturer certificate.  <a href="oc__pki_8h.html#a45268a2eeaee3686f497f25d97dc43e4">More...</a><br /></td></tr>
<tr class="separator:a45268a2eeaee3686f497f25d97dc43e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad6daa707a2ad5d7265470b32e6e596fe"><td class="memItemLeft" align="right" valign="top">OC_API void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc__pki_8h.html#ad6daa707a2ad5d7265470b32e6e596fe">oc_pki_set_verify_certificate_cb</a> (<a class="el" href="oc__pki_8h.html#a96373a3f65a5a29bafab923471f8aa3a">oc_pki_verify_certificate_cb_t</a> cb)</td></tr>
<tr class="memdesc:ad6daa707a2ad5d7265470b32e6e596fe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the verification callback for the certificate chain.  <a href="oc__pki_8h.html#ad6daa707a2ad5d7265470b32e6e596fe">More...</a><br /></td></tr>
<tr class="separator:ad6daa707a2ad5d7265470b32e6e596fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>OCF public key infrastructure (PKI) functions. </p>
<p>Collection of functions used to add public key infrastructure (PKI) support to devices. </p>
</div><h2 class="groupheader">Typedef Documentation</h2>
<a id="af29204f5d000da45ad49dbea7508a95f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af29204f5d000da45ad49dbea7508a95f">&#9670;&nbsp;</a></span>mbedtls_pk_ecp_gen_key_cb_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int(* mbedtls_pk_ecp_gen_key_cb_t) (size_t device, mbedtls_ecp_group_id grp_id, mbedtls_pk_context *pk, int(*f_rng)(void *, unsigned char *, size_t), void *p_rng)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function generates the ECP key for the identity certificate of the device. </p>
<p>If the device has a TPM, the function will generate a private key within the TPM and store it there. The generated key is returned as an object that can be used to create an identity certificate.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">device</td><td>The device index the key belongs to. </td></tr>
    <tr><td class="paramname">grp_id</td><td>The ECP group identifier. </td></tr>
    <tr><td class="paramname">pk</td><td>The destination key. The key is initialized by MBEDTLS_PK_ECKEY. </td></tr>
    <tr><td class="paramname">f_rng</td><td>The RNG function to use. This must not be <code>NULL</code>. </td></tr>
    <tr><td class="paramname">p_rng</td><td>The RNG context to be passed to <code>f_rng</code>. This may be <code>NULL</code> if <code>f_rng</code> doesn't need a context argument.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>0</code> on success. </dd>
<dd>
An <code>MBEDTLS_ERR_ECP_XXX</code> or <code>MBEDTLS_MPI_XXX</code> error code on failure. </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a href="https://arm-software.github.io/CMSIS-mbedTLS/latest/ecp_8h.html#a0c9a407214f019493ba5d7bc27fa57dc">https://arm-software.github.io/CMSIS-mbedTLS/latest/ecp_8h.html#a0c9a407214f019493ba5d7bc27fa57dc</a> </dd></dl>

</div>
</div>
<a id="a4b55ababec511ce8c3f5ebfae983804a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b55ababec511ce8c3f5ebfae983804a">&#9670;&nbsp;</a></span>mbedtls_pk_parse_key_cb_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int(* mbedtls_pk_parse_key_cb_t) (size_t device, mbedtls_pk_context *pk, const unsigned char *key, size_t keylen, const unsigned char *pwd, size_t pwdlen, int(*f_rng)(void *, unsigned char *, size_t), void *p_rng)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function loads a private key for use with identity or manufacturer certificates stored in the credential resource of a device. </p>
<p>The private key can be provided in either PEM or DER format, or by reference to a previously stored private key in TPM. The function parses the provided private key and returns a loaded private key object, which can then be used in cryptographic operations.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">device</td><td>The device index the key belongs to. </td></tr>
    <tr><td class="paramname">pk</td><td>The PK context to fill. It must have been initialized but not set up. </td></tr>
    <tr><td class="paramname">key</td><td>Input buffer to parse. The buffer must contain the input exactly, with no extra trailing material. For PEM, the buffer must contain a null-terminated string. It could be PEM, DER or the reference key (eg in TPM). </td></tr>
    <tr><td class="paramname">keylen</td><td>Size of <b>key</b> in bytes. For PEM data, this includes the terminating null byte, so <code>keylen</code> must be equal to <code>strlen(key) + 1</code>. </td></tr>
    <tr><td class="paramname">pwd</td><td>Optional password for decryption. Pass <code>NULL</code> if expecting a non-encrypted key. Pass a string of <code>pwdlen</code> bytes if expecting an encrypted key; a non-encrypted key will also be accepted. The empty password is not supported. </td></tr>
    <tr><td class="paramname">pwdlen</td><td>Size of the password in bytes. Ignored if <code>pwd</code> is <code>NULL</code>. </td></tr>
    <tr><td class="paramname">f_rng</td><td>RNG function, must not be <code>NULL</code>. Used for blinding. </td></tr>
    <tr><td class="paramname">p_rng</td><td>RNG parameter</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>On entry, ctx must be empty, either freshly initialised with mbedtls_pk_init() or reset with mbedtls_pk_free(). If you need a specific key type, check the result with mbedtls_pk_can_do().</dd>
<dd>
The key is also checked for correctness.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>0 if successful, or a specific PK or PEM error code </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a href="https://arm-software.github.io/CMSIS-mbedTLS/latest/pk_8h.html#aad02107b63f2a47020e6e1ef328e4393">https://arm-software.github.io/CMSIS-mbedTLS/latest/pk_8h.html#aad02107b63f2a47020e6e1ef328e4393</a> </dd></dl>

</div>
</div>
<a id="a4078582ecfdc45634dfde779e420a4f2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4078582ecfdc45634dfde779e420a4f2">&#9670;&nbsp;</a></span>mbedtls_pk_write_key_der_cb_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int(* mbedtls_pk_write_key_der_cb_t) (size_t device, const mbedtls_pk_context *ctx, unsigned char *buf, size_t size)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function writes a private key to the credential resource for storage. </p>
<p>The private key can be provided as an object and will be written in either PKCS#1 or SEC1 DER structure, depending on the specified format. Alternatively, a reference to a private key stored in TPM can be provided, and the function will write the reference to the credential resource. Once the private key is written, it can be used with identity or manufacturer certificates for cryptographic operations. Note: data is written at the end of the buffer! Use the return value to determine where you should start using the buffer</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">device</td><td>The device index the key belongs to. </td></tr>
    <tr><td class="paramname">ctx</td><td>PK context which must contain a valid private key. </td></tr>
    <tr><td class="paramname">buf</td><td>buffer to write to </td></tr>
    <tr><td class="paramname">size</td><td>size of the buffer</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>length of data written if successful, or a specific error code </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a href="https://arm-software.github.io/CMSIS-mbedTLS/latest/pk_8h.html#a2cf4ebaa430cc90954c9556ace2d4dc0">https://arm-software.github.io/CMSIS-mbedTLS/latest/pk_8h.html#a2cf4ebaa430cc90954c9556ace2d4dc0</a> </dd></dl>

</div>
</div>
<a id="a96373a3f65a5a29bafab923471f8aa3a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a96373a3f65a5a29bafab923471f8aa3a">&#9670;&nbsp;</a></span>oc_pki_verify_certificate_cb_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int(* oc_pki_verify_certificate_cb_t) (struct oc_tls_peer_t *peer, const mbedtls_x509_crt *crt, int depth, uint32_t *flags)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback invoked after ocf verifies the certificate chain. </p>
<p>For each certificate in the chain, the callback is invoked with the depth of the certificate in the chain.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">peer</td><td>TLS peer connection </td></tr>
    <tr><td class="paramname">crt</td><td>Certificate </td></tr>
    <tr><td class="paramname">depth</td><td>Depth of the certificate chain, 0 is the leaf certificate. </td></tr>
    <tr><td class="paramname">flags</td><td>Verification flags from mbedtls_x509_crt_verify(), see <a href="https://github.com/Mbed-TLS/mbedtls/blob/10ada3501975e7abab25a7fa28e9e8e0f6b4259f/include/mbedtls/x509.h#L99">https://github.com/Mbed-TLS/mbedtls/blob/10ada3501975e7abab25a7fa28e9e8e0f6b4259f/include/mbedtls/x509.h#L99</a></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if the certificate is valid, otherwise -1 </dd></dl>

</div>
</div>
<a id="a35ac3b04f4e220eb57b47ebd501469b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a35ac3b04f4e220eb57b47ebd501469b2">&#9670;&nbsp;</a></span>pk_free_key_cb_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef bool(* pk_free_key_cb_t) (size_t device, const unsigned char *key, size_t keylen)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function frees the private key of the device generated by mbedtls_pk_ecp_gen_key_cb_t. </p>
<p>It is called when factory reset is performed or during generating csr when the key-pair is not valid.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">device</td><td>The device index the key belongs to. </td></tr>
    <tr><td class="paramname">key</td><td>The private key to free. </td></tr>
    <tr><td class="paramname">keylen</td><td>The length of the private key.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true, the key is invalid and needs to be regenerated </dd>
<dd>
false, the key is still valid</dd></dl>
<dl class="section note"><dt>Note</dt><dd>default implementation returns false, so the key is same as before.</dd></dl>
<dl class="section see"><dt>See also</dt><dd>oc_mbedtls_pk_ecp_gen_key </dd></dl>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a667f95ddb5dcb4ed5eaeb72fe201c2f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a667f95ddb5dcb4ed5eaeb72fe201c2f6">&#9670;&nbsp;</a></span>oc_pki_add_identity_cert()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">OC_API int oc_pki_add_identity_cert </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>device</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned char *&#160;</td>
          <td class="paramname"><em>cert</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>cert_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned char *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>key_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add a PKI identity certificate. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">device</td><td>index of the logical device the identity certificate belongs to </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cert</td><td>pointer to a string containing a PEM encoded identity certificate </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cert_size</td><td>the size of the <code>cert</code> string </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">key</td><td>the PEM encoded private key associated with this certificate </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">key_size</td><td>the size of the <code>key</code> string</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>the credential ID of the /oic/sec/cred entry containing the certificate chain</li>
<li><code>-1</code> on failure </li>
</ul>
</dd></dl>

</div>
</div>
<a id="aab97e9763dae4cd5f115f0f4d0866ff4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aab97e9763dae4cd5f115f0f4d0866ff4">&#9670;&nbsp;</a></span>oc_pki_add_mfg_cert()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">OC_API int oc_pki_add_mfg_cert </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>device</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned char *&#160;</td>
          <td class="paramname"><em>cert</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>cert_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned char *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>key_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add the manufacturer's PKI identity certificate. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">device</td><td>index of the logical device the identity certificate belongs to </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cert</td><td>pointer to a string containing a PEM encoded identity certificate </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cert_size</td><td>the size of the <code>cert</code> string </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">key</td><td>the PEM encoded private key associated with this certificate </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">key_size</td><td>the size of the <code>key</code> string</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>the credential ID of the /oic/sec/cred entry containing the certificate chain</li>
<li><code>-1</code> on failure </li>
</ul>
</dd></dl>

</div>
</div>
<a id="a72061193a3d41bf230a2926fc3e17109"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a72061193a3d41bf230a2926fc3e17109">&#9670;&nbsp;</a></span>oc_pki_add_mfg_intermediate_cert()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">OC_API int oc_pki_add_mfg_intermediate_cert </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>device</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>credid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned char *&#160;</td>
          <td class="paramname"><em>cert</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>cert_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add an intermediate manufacture CA certificate. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">device</td><td>index of the logical device the certificate chain belongs to </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">credid</td><td>the credential ID of the /oic/sec/cred entry containing the end-entity certificate </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cert</td><td>pointer to a string containing a PEM encoded certificate </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cert_size</td><td>the size of the <code>cert</code> string</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>the credential ID of the /oic/sec/cred entry containing the certificate chain</li>
<li><code>-1</code> on failure </li>
</ul>
</dd></dl>

</div>
</div>
<a id="a0955c5ab3d9f103a440adf48b47e6ff3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0955c5ab3d9f103a440adf48b47e6ff3">&#9670;&nbsp;</a></span>oc_pki_add_mfg_trust_anchor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">OC_API int oc_pki_add_mfg_trust_anchor </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>device</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned char *&#160;</td>
          <td class="paramname"><em>cert</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>cert_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add manufacture trust anchor CA. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">device</td><td>index of the logical device the trust anchor CA belongs to </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cert</td><td>pointer to a string containing a PEM encoded certificate </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cert_size</td><td>the size of the <code>cert</code> string</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>the credential ID of the /oic/sec/cred entry containing the certificate chain</li>
<li><code>-1</code> on failure </li>
</ul>
</dd></dl>

</div>
</div>
<a id="ac7edd9a38172f7a0ef531b148e32b855"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac7edd9a38172f7a0ef531b148e32b855">&#9670;&nbsp;</a></span>oc_pki_add_trust_anchor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">OC_API int oc_pki_add_trust_anchor </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>device</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned char *&#160;</td>
          <td class="paramname"><em>cert</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>cert_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add trust anchor CA. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">device</td><td>index of the logical device the trust anchor CA belongs to </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cert</td><td>pointer to a string containing a PEM encoded certificate </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cert_size</td><td>the size of the <code>cert</code> strung</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>the credential ID of the /oic/sec/cred entry containing the certificate chain</li>
<li><code>-1</code> on failure </li>
</ul>
</dd></dl>

</div>
</div>
<a id="a383674de8688e1f06394d2d4b2acea8c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a383674de8688e1f06394d2d4b2acea8c">&#9670;&nbsp;</a></span>oc_pki_get_pk_functions()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">OC_API bool oc_pki_get_pk_functions </td>
          <td>(</td>
          <td class="paramtype">oc_pki_pk_functions_t *&#160;</td>
          <td class="paramname"><em>pk_functions</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the PK functions for the identity certificate or the manufacturer certificate. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">pk_functions</td><td>the PK functions </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if the PK functions have been configured through the oc_pki_set_pk_functions function. </dd></dl>

</div>
</div>
<a id="a5915036eb21af89dae768c8b59d32476"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5915036eb21af89dae768c8b59d32476">&#9670;&nbsp;</a></span>oc_pki_get_verify_certificate_cb()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">OC_API <a class="el" href="oc__pki_8h.html#a96373a3f65a5a29bafab923471f8aa3a">oc_pki_verify_certificate_cb_t</a> oc_pki_get_verify_certificate_cb </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the verification callback for the certificate chain. </p>
<dl class="section return"><dt>Returns</dt><dd>the callback function </dd></dl>

</div>
</div>
<a id="a45268a2eeaee3686f497f25d97dc43e4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a45268a2eeaee3686f497f25d97dc43e4">&#9670;&nbsp;</a></span>oc_pki_set_pk_functions()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">OC_API bool oc_pki_set_pk_functions </td>
          <td>(</td>
          <td class="paramtype">const oc_pki_pk_functions_t *&#160;</td>
          <td class="paramname"><em>pk_functions</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the PK functions for the identity certificate or the manufacturer certificate. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pk_functions</td><td>the PK functions, if NULL, the default mbedtls functions will be used. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if the PK functions have been set. </dd>
<dd>
false when any of the functions is NULL. </dd></dl>

</div>
</div>
<a id="ad6daa707a2ad5d7265470b32e6e596fe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad6daa707a2ad5d7265470b32e6e596fe">&#9670;&nbsp;</a></span>oc_pki_set_verify_certificate_cb()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">OC_API void oc_pki_set_verify_certificate_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="oc__pki_8h.html#a96373a3f65a5a29bafab923471f8aa3a">oc_pki_verify_certificate_cb_t</a>&#160;</td>
          <td class="paramname"><em>cb</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the verification callback for the certificate chain. </p>
<p>It is invoked after ocf verifies the certificate chain. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cb</td><td>the callback function </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="oc__pki_8h.html">oc_pki.h</a></li>
    <li class="footer">Generated on Tue May 16 2023 10:47:55 for IoTivity-Lite by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
